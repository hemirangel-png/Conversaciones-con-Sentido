<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario - Conversaciones con Sentido</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-image: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      font-family: 'Inter', sans-serif;
    }
    
    /* Overlay para mejorar legibilidad */
    .bg-overlay {
      background: rgba(255, 255, 255, 0.92);
      backdrop-filter: blur(5px);
    }
    
    /* Para móviles, menos desenfoque */
    @media (max-width: 768px) {
      body {
        background-attachment: scroll;
      }
      .bg-overlay {
        background: rgba(255, 255, 255, 0.96);
        backdrop-filter: blur(2px);
      }
    }
    
    /* Animaciones suaves */
    .fade-in {
      animation: fadeIn 0.8s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Mejoras para inputs */
    .input-zen {
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(209, 213, 219, 0.5);
    }
    
    .input-zen:focus {
      background: rgba(255, 255, 255, 0.9);
      border-color: rgba(47, 133, 90, 0.5);
      box-shadow: 0 0 0 3px rgba(47, 133, 90, 0.1);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Storage mock usando localStorage
    window.storage = {
      async get(key) {
        const stored = localStorage.getItem(key);
        return stored ? { key, value: stored } : null;
      },
      async set(key, value) {
        localStorage.setItem(key, value);
        return { key, value };
      },
      async delete(key) {
        localStorage.removeItem(key);
        return { key, deleted: true };
      },
      async list(prefix) {
        const keys = Object.keys(localStorage).filter(k => k.startsWith(prefix || ''));
        return { keys };
      }
    };

    // Iconos SVG
    const ChevronRight = ({className}) => <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>;
    const ChevronLeft = ({className}) => <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;
    const Check = ({className}) => <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>;
    const Heart = ({className}) => <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>;

    function ConversacionesForm() {
      const [step, setStep] = useState(0);
      const [submitted, setSubmitted] = useState(false);
      const [selectedService, setSelectedService] = useState('');
      const [formData, setFormData] = useState({
        nombre: '',
        email: '',
        telefono: '',
        pais: '',
        sinProblema: '',
        nombreDificultad: '',
        tiempoPresente: '',
        comoControlas: '',
        fortalezasOtros: '',
        opcionElegida: '',
        preguntaFundamental: ''
      });

      // Obtener el servicio seleccionado de localStorage al cargar
      useEffect(() => {
        const service = localStorage.getItem('selectedService');
        if (service) {
          setSelectedService(service);
        }
      }, []);

      const handleChange = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
      };

      const handleSubmit = async () => {
        try {
          await window.storage.set(`solicitud:${Date.now()}`, JSON.stringify({
            ...formData,
            servicio: selectedService,
            fecha: new Date().toISOString(),
            estado: 'nuevo'
          }));
          setSubmitted(true);
        } catch (error) {
          console.error('Error al guardar:', error);
          alert('Hubo un error. Por favor intenta de nuevo.');
        }
      };

      const canProceed = () => {
        switch(step) {
          case 0:
            return formData.nombre && formData.email && formData.telefono && formData.pais;
          case 1:
            return formData.sinProblema;
          case 2:
            return formData.nombreDificultad && formData.tiempoPresente;
          case 3:
            return formData.comoControlas && formData.fortalezasOtros;
          case 4:
            return formData.opcionElegida;
          case 5:
            return formData.preguntaFundamental;
          default:
            return true;
        }
      };

      if (submitted) {
        return (
          <div className="min-h-screen flex items-center justify-center p-4 fade-in">
            <div className="max-w-2xl w-full bg-white rounded-xl shadow-lg p-8 md:p-12 text-center border border-gray-200 bg-overlay">
              <div className="w-24 h-24 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                <Heart className="w-12 h-12 text-white" />
              </div>
              <h2 className="text-3xl md:text-4xl font-light text-gray-800 mb-4">
                Tu solicitud ha sido recibida
              </h2>
              <p className="text-lg text-gray-600 mb-6 leading-relaxed">
                Alguien de nuestro equipo de Conversaciones con Sentido se pondrá en contacto contigo vía WhatsApp
              </p>
              <div className="w-16 h-1 bg-gradient-to-r from-green-500 to-green-600 mx-auto mb-6 rounded-full"></div>
              <p className="text-gray-500 italic">
                Gracias por confiar en nosotros para tu proceso
              </p>
              <div className="mt-8 p-4 bg-green-50 rounded-lg">
                <p className="text-sm text-green-700">
                  <strong>Servicio seleccionado:</strong> {
                    selectedService === '7preguntas' ? '7 Preguntas para Comenzar el Cambio' :
                    selectedService === 'expres' ? 'CCS Exprés' :
                    selectedService === 'camino' ? 'CCS "El Camino"' :
                    'No especificado'
                  }
                </p>
              </div>
            </div>
          </div>
        );
      }

      const steps = [
        {
          title: 'Datos de Contacto',
          content: (
            <div className="space-y-6 fade-in">
              <div>
                <label className="block text-gray-700 font-medium mb-2">Nombre *</label>
                <input
                  type="text"
                  value={formData.nombre}
                  onChange={(e) => handleChange('nombre', e.target.value)}
                  className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 focus:outline-none transition input-zen"
                  placeholder="Tu nombre completo"
                />
              </div>
              <div className="grid md:grid-cols-2 gap-6">
                <div>
                  <label className="block text-gray-700 font-medium mb-2">Email *</label>
                  <input
                    type="email"
                    value={formData.email}
                    onChange={(e) => handleChange('email', e.target.value)}
                    className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 focus:outline-none transition input-zen"
                    placeholder="tu@email.com"
                  />
                </div>
                <div>
                  <label className="block text-gray-700 font-medium mb-2">Teléfono *</label>
                  <input
                    type="tel"
                    value={formData.telefono}
                    onChange={(e) => handleChange('telefono', e.target.value)}
                    className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 focus:outline-none transition input-zen"
                    placeholder="+56 9 1234 5678"
                  />
                </div>
              </div>
              <div>
                <label className="block text-gray-700 font-medium mb-2">País *</label>
                <input
                  type="text"
                  value={formData.pais}
                  onChange={(e) => handleChange('pais', e.target.value)}
                  className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 focus:outline-none transition input-zen"
                  placeholder="Tu país de residencia"
                />
              </div>
            </div>
          )
        },
        {
          title: 'Visión del Cambio',
          content: (
            <div className="space-y-6 fade-in">
              <div>
                <label className="block text-gray-700 font-medium mb-2">
                  Si mañana despertaras sin el problema, ¿qué sería lo primero en que lo notarías? *
                </label>
                <textarea
                  value={formData.sinProblema}
                  onChange={(e) => handleChange('sinProblema', e.target.value)}
                  className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 focus:outline-none transition input-zen"
                  rows="4"
                  placeholder="Describe ese primer momento de cambio..."
                />
              </div>
            </div>
          )
        },
        {
          title: 'Conociendo tu Dificultad',
          content: (
            <div className="space-y-6 fade-in">
              <div>
                <label className="block text-gray-700 font-medium mb-2">
                  Si esta dificultad que estás viviendo tuviera un nombre o fuera un personaje, ¿cómo lo llamarías? *
                </label>
                <textarea
                  value={formData.nombreDificultad}
                  onChange={(e) => handleChange('nombreDificultad', e.target.value)}
                  className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 focus:outline-none transition input-zen"
                  rows="3"
                  placeholder="Ej: 'El Perfeccionista', 'La Ansiedad', 'El Miedo al Fracaso'..."
                />
              </div>
              <div>
                <label className="block text-gray-700 font-medium mb-2">
                  ¿Desde cuándo ha estado presente en tu vida? *
                </label>
                <textarea
                  value={formData.tiempoPresente}
                  onChange={(e) => handleChange('tiempoPresente', e.target.value)}
                  className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 focus:outline-none transition input-zen"
                  rows="2"
                  placeholder="Ej: 'Desde la adolescencia', 'Hace aproximadamente 2 años', 'Desde que cambié de trabajo'..."
                />
              </div>
            </div>
          )
        },
        {
          title: 'Tus Recursos y Fortalezas',
          content: (
            <div className="space-y-6 fade-in">
              <div>
                <label className="block text-gray-700 font-medium mb-2">
                  ¿Cómo has logrado que las cosas no estén peor de lo que están? *
                </label>
                <p className="text-gray-500 text-sm mb-3">
                  ¿Qué has hecho para mantener esto bajo control hasta ahora?
                </p>
                <textarea
                  value={formData.comoControlas}
                  onChange={(e) => handleChange('comoControlas', e.target.value)}
                  className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 focus:outline-none transition input-zen"
                  rows="4"
                  placeholder="Describe las estrategias, pensamientos o acciones que te han ayudado..."
                />
              </div>
              <div>
                <label className="block text-gray-700 font-medium mb-2">
                  Si alguien cercano a ti describiera tus fortalezas, ¿qué crees que diría? *
                </label>
                <textarea
                  value={formData.fortalezasOtros}
                  onChange={(e) => handleChange('fortalezasOtros', e.target.value)}
                  className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 focus:outline-none transition input-zen"
                  rows="4"
                  placeholder="Ej: 'Diría que soy resiliente', 'Que tengo sentido del humor', 'Que soy buena escuchando'..."
                />
              </div>
            </div>
          )
        },
        {
          title: 'Tu Decisión',
          content: (
            <div className="space-y-6 fade-in">
              <div>
                <label className="block text-gray-700 font-medium mb-2 text-lg">
                  Opción A vs Opción B *
                </label>
                <p className="text-gray-500 text-sm mb-4">
                  Si pudieras elegir entre dos opciones:
                </p>
                
                <div className="grid md:grid-cols-2 gap-6 mb-6">
                  <div className="border-2 border-red-200 rounded-lg p-4 bg-red-50">
                    <h4 className="font-bold text-red-700 mb-2 text-center">Opción A</h4>
                    <p className="text-sm text-red-600 text-center">
                      Seguir luchando para eliminar este malestar/pensamiento/sentimiento y que tu vida siga en pausa
                    </p>
                  </div>
                  <div className="border-2 border-green-200 rounded-lg p-4 bg-green-50">
                    <h4 className="font-bold text-green-700 mb-2 text-center">Opción B</h4>
                    <p className="text-sm text-green-600 text-center">
                      Llevarlo contigo como un compañero incómodo pero poder moverte hacia lo que realmente te importa
                    </p>
                  </div>
                </div>

                <div className="space-y-4">
                  <label className="flex items-center space-x-3 p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input
                      type="radio"
                      name="opcionElegida"
                      value="A"
                      checked={formData.opcionElegida === 'A'}
                      onChange={(e) => handleChange('opcionElegida', e.target.value)}
                      className="text-green-500 focus:ring-green-500"
                    />
                    <span className="font-medium">Opción A - Seguir luchando para eliminar</span>
                  </label>
                  
                  <label className="flex items-center space-x-3 p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input
                      type="radio"
                      name="opcionElegida"
                      value="B"
                      checked={formData.opcionElegida === 'B'}
                      onChange={(e) => handleChange('opcionElegida', e.target.value)}
                      className="text-green-500 focus:ring-green-500"
                    />
                    <span className="font-medium">Opción B - Llevarlo como compañero y avanzar</span>
                  </label>
                </div>
              </div>
              
              {formData.opcionElegida && (
                <div className="p-4 bg-blue-50 rounded-lg border border-blue-200">
                  <p className="text-blue-700 text-sm">
                    <strong>Reflexión:</strong> Tu elección nos ayuda a entender mejor tu disposición al cambio. 
                    Ambas opciones son válidas y representan diferentes enfoques para enfrentar las dificultades.
                  </p>
                </div>
              )}
            </div>
          )
        },
        {
          title: 'La Pregunta Fundamental',
          content: (
            <div className="space-y-6 fade-in">
              <div className="text-center mb-6">
                <div className="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i className="fas fa-question text-white text-2xl"></i>
                </div>
                <h3 className="text-2xl font-bold text-gray-800 mb-2">La Pregunta Fundamental</h3>
                <p className="text-gray-600">
                  Después de todo este recorrido reflexivo...
                </p>
              </div>
              
              <div>
                <label className="block text-gray-700 font-medium mb-2 text-lg">
                  ¿Cuál es la pregunta fundamental que te trae aquí hoy? *
                </label>
                <p className="text-gray-500 text-sm mb-4">
                  Resume en una pregunta esencial lo que realmente quieres resolver o comprender
                </p>
                <textarea
                  value={formData.preguntaFundamental}
                  onChange={(e) => handleChange('preguntaFundamental', e.target.value)}
                  className="w-full px-4 py-4 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 focus:outline-none transition input-zen text-lg"
                  rows="5"
                  placeholder="Ej: '¿Cómo puedo encontrar paz interior?', '¿Qué necesito para sentirme completo?', '¿Cómo superar este miedo que me paraliza?'..."
                />
              </div>
              
              <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                <p className="text-green-700 text-sm">
                  <strong>Nota:</strong> Esta pregunta será el punto de partida para nuestras conversaciones. 
                  Tómate un momento para formularla con cuidado, ya que guiará nuestro trabajo juntos.
                </p>
              </div>
            </div>
          )
        }
      ];

      return (
        <div className="min-h-screen py-8 px-4">
          <div className="max-w-3xl mx-auto fade-in">
            <div className="text-center mb-8">
              <div className="flex justify-center items-center mb-4">
                <div className="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mr-3 shadow-md">
                  <Heart className="w-6 h-6 text-white" />
                </div>
                <h1 className="text-4xl md:text-5xl font-light text-gray-800">
                  Conversaciones con Sentido
                </h1>
              </div>
              <p className="text-lg text-gray-600">
                Completa el formulario para comenzar tu proceso
              </p>
              {selectedService && (
                <div className="mt-4 inline-block px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-medium">
                  Servicio: {
                    selectedService === '7preguntas' ? '7 Preguntas para Comenzar el Cambio' :
                    selectedService === 'expres' ? 'CCS Exprés' :
                    selectedService === 'camino' ? 'CCS "El Camino"' :
                    'No especificado'
                  }
                </div>
              )}
            </div>

            <div className="mb-8">
              <div className="flex justify-between mb-2">
                {steps.map((_, idx) => (
                  <div
                    key={idx}
                    className={`flex-1 h-2 mx-1 rounded-full transition-all ${
                      idx <= step ? 'bg-gradient-to-r from-green-500 to-green-600' : 'bg-gray-200'
                    }`}
                  />
                ))}
              </div>
              <p className="text-center text-gray-500 text-sm">
                Paso {step + 1} de {steps.length}
              </p>
            </div>

            <div className="bg-white rounded-xl shadow-lg p-6 md:p-10 border border-gray-200 bg-overlay">
              <h2 className="text-2xl md:text-3xl font-light text-gray-800 mb-6 flex items-center">
                <div className="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center text-white text-sm font-medium mr-3">
                  {step + 1}
                </div>
                {steps[step].title}
              </h2>
              
              {steps[step].content}

              <div className="flex justify-between mt-8">
                <button
                  onClick={() => setStep(step - 1)}
                  disabled={step === 0}
                  className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition ${
                    step === 0
                      ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  <ChevronLeft className="w-5 h-5" />
                  Anterior
                </button>

                {step < steps.length - 1 ? (
                  <button
                    onClick={() => setStep(step + 1)}
                    disabled={!canProceed()}
                    className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition ${
                      canProceed()
                        ? 'bg-green-500 text-white hover:bg-green-600'
                        : 'bg-gray-100 text-gray-400 cursor-not-allowed'
                    }`}
                  >
                    Siguiente
                    <ChevronRight className="w-5 h-5" />
                  </button>
                ) : (
                  <button
                    onClick={handleSubmit}
                    disabled={!canProceed()}
                    className={`flex items-center gap-2 px-8 py-3 rounded-lg font-medium transition ${
                      canProceed()
                        ? 'bg-green-500 text-white hover:bg-green-600'
                        : 'bg-gray-100 text-gray-400 cursor-not-allowed'
                    }`}
                  >
                    Enviar
                    <Check className="w-5 h-5" />
                  </button>
                )}
              </div>
            </div>

            <p className="text-center text-gray-500 mt-8 text-sm">
              * Campos obligatorios
            </p>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<ConversacionesForm />);
  </script>
</body>
</html>